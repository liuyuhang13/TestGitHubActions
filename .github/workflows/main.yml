name: Update target branch from main

on:
  workflow_dispatch:
    inputs:
      targetBranch:
        description: 'Target branch'     
        required: true
        default: 'release'
concurrency: ${{ github.workflow }}

permissions:
  # Required to clone repo and push commits
  contents: write

jobs:
  update_release_branch:
    name: Update release branch
    if: "github.ref == 'refs/heads/main'"
    runs-on: ubuntu-latest

    steps:
      - name: Clone main branch
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
        
      - name: Update tewst branch
        env: 
          GIT_AUTHOR_NAME: github-actions[bot]
          GIT_COMMITTER_NAME: GitHub
          GIT_COMMITTER_EMAIL: noreply@github.com
        run: |
          git switch main
          git fetch origin
          git switch test
          git pull
          git merge origin/main
          git push origin test  
